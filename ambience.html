<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>RPG Ambience</title>
		
		<link rel="stylesheet" href="libraries/number-polyfill.css">
		<link rel="stylesheet" href="libraries/spectrum.css">
		
		<link rel="stylesheet" href="common.css">
		<link rel="stylesheet" href="generic.css" title="Generic">
		<link rel="icon" type="image/png" href="images/icon.png">
		
		<script>
			window.URL = window.URL || window.webkitURL;
			window.indexedDB = window.indexedDB || window.webkitIndexedDB;
		</script>
		
		<script src="libraries/debug.js"></script>
		
		<script src="libraries/jquery.js"></script>
		<script src="libraries/jquery-ui.js"></script>
		<script src="libraries/knockout.js"></script>
		<script src="libraries/knockout-sortable.js"></script>
		<script src="libraries/knockwrap.js"></script>

		<script src="libraries/knockout-polyfill.js"></script>
		<script src="libraries/number-polyfill.js"></script>
		<script src="libraries/spectrum.js"></script>
		<script src="libraries/knockout-spectrum.js"></script>
		
		<script src="libraries/functions.js"></script>
		<script src="libraries/splitter.js"></script>
		<script src="libraries/manymation/source/manymation.js"></script>
		<script src="libraries/key.js"></script>
		<script src="libraries/file-button.js"></script>
		<script src="libraries/object-url-from-data-url.js"></script>
		
		<script src="source/ambience.js"></script>
		<script src="source/media/image.js"></script>
		<script src="source/media/sound-list.js"></script>
		<script src="source/media/sound.js"></script>
		<script src="source/media/background.js"></script>
		<script src="source/media/text.js"></script>
		<script src="source/layer.js"></script>
		<script src="source/scene.js"></script>
		<script src="source/immersive/adventure.js"></script>
		<script src="source/immersive/adventure-view-model.js"></script>
		<script src="source/immersive/adventure-library.js"></script>
		<script src="source/immersive/media-library.js"></script>
		<script src="source/immersive/immersive.js"></script>
	</head>
	<body>
		<div
			id="theater"
			class="theater"
			data-bind="
				event: {
					mousemove: scheduleHiddenInterface,
					mouseover: scheduleHiddenInterface,
					mouseout: showInterface
				}
			">
			<div id="background" class="layer"></div>
			<div id="foreground" class="layer"></div>
		</div>
		<div id="interface" class="interface">
			<div
				id="editor"
				class="editor"
				data-bind="
					event: {
						keydown: stopPropagation,
						keypress: stopPropagation
					}">
				<div class="menu-bar">
					<ul class="action-list adventure">
						<li class="action">
							<select data-bind="options: adventures, optionsText: 'title', value: adventure"></select>
						</li>
						<li class="action new">
							<button data-bind="click: createAdventure">New Adventure</button>
						</li>
						<li class="action rename">
							<button
								id="rename-button"
								data-bind="
									visible: !renameInProgress,
									event: { click: startRename}">Rename Adventure</button>
							<input
								id="rename-input"
								type="text"
								data-bind="
									event: { blur: stopRename },
									visible: renameInProgress,
									value: adventure.title,
									valueUpdate: 'afterkeydown'
								">
						</li>
					</ul>
					<ul class="action-list playback">
						<li class="action play"><button data-bind="click: playSelected">Play</button></li>
						<li class="action stop"><button data-bind="click: stopCurrent">Stop</button></li>
					</ul>
				</div>
				<div class="view-list" id="view-list">
					<ul class="tab-list">
						<li class="tab">
							<a href="#scene-tab">Scenes</a>
						</li>
						<li class="tab">
							<a href="#help-tab">Help</a>
						</li>
					</ul>
					<div class="scene-view tab-content" id="scene-tab">
						<!-- ko with: adventure -->
							<div
								class="list-view"
								data-bind="
									event: {
										drop: onFilesDropped,
										dragover: onDrag
									}"
							>
								<ul data-bind="foreach: scenes, sortable: true">
									<li
										class="list-item"
										data-bind="css: { selected: $parent.current === $data }">
										<a href="#" data-bind="click: $parent.select">
											<div class="preview" data-bind="
												style: {
													backgroundColor: background,
													backgroundImage: image.css,
													backgroundSize: image.size
												}
											">
												<div class="text outer">
													<div
														class="text inner"
														data-bind="
															text: text.string,
															style: {
																fontSize: text.previewSize,
																fontFamily: text.font,
																fontStyle: text.style,
																fontWeight: text.weight,
																color: text.color,
																textAlign: text.alignment,
																padding: text.previewPadding
															}
														"></div>
												</div>
											</div>
											<!-- ko if: name -->
												<span data-bind="text: name"></span>
											<!-- /ko -->
											<!-- ko if: key -->
												<span data-bind="text: key" class="key"></span>
											<!-- /ko -->
											<div class="icons">
												<!-- ko if: mixin -->
													<img src="images/mixin.svg" title="Mixin">
												<!-- /ko -->
												<!-- ko if: isForeground -->
													<img src="images/foreground.svg" title="Foreground">
												<!-- /ko -->
											</div>
										</a>
									</li>
								</ul>
								<div class="add-item">
									<button data-bind="click: add">Add Scene</button>
								</div>
							</div>
							<!-- ko with: current, polyfill: true -->
							<div class="detail-view">
								<div
									class="selected-item"
									data-bind="
										event: {
											drop: onFilesDropped,
											dragover: onDrag
										}"
								>
									<ul class="action-list">
										<li class="action copy"><button data-bind="click: $parent.copySelected">Copy</button></li>
										<li class="action remove"><button data-bind="click: $parent.removeSelected">Remove</button></li>
									</ul>
									<div class="preview" data-bind="
										style: {
											backgroundColor: background,
											backgroundImage: image.css,
											backgroundSize: image.size
										}
									">
										<div class="text outer">
											<div
												class="text inner"
												data-bind="
													text: text.string,
													style: {
														fontSize: text.previewSize,
														fontFamily: text.font,
														fontStyle: text.style,
														fontWeight: text.weight,
														color: text.color,
														textAlign: text.alignment,
														padding: text.previewPadding
													}
												"></div>
										</div>
									</div>
									<div class="options general">
										<table>
											<tr>
												<th><label for="name">Name</label></th>
												<td>
													<input
														id="name"
														type="text"
														placeholder="Untitled"
														data-bind="
															value: name,
															valueUpdate: 'afterkeydown'
														">
												</td>
											</tr>
											<tr>
												<th><label for="key">Hotkey</label></th>
												<td>
													<input
														id="key"
														type="text"
														data-bind="
															value: key,
															valueUpdate: 'afterkeydown',
															event: {
																keydown: $parent.bindSpecialKey,
																keypress: $parent.bindTextKey,
																keyup: $parent.stopKeyBinding
															}
														">
												</td>
											</tr>
											<tr>
												<th><label for="layer">Layer</label></th>
												<td>
													<ul class="control-list">
														<li>
															<select id="layer" data-bind="value: layer">
																<option value="background">Background</option>
																<option value="foreground">Foreground</option>
															</select>
														</li>
														<li>
															<label for="mixin" data-bind="attr: { title: $root.help.mixin }">
																<input
																	id="mixin"
																	type="checkbox"
																	data-bind="checked: mixin">
																Mixin
															</label>
														</li>
													</ul>
												</td>
											</tr>
										</table>
									</div>
									<div class="options specific">
										<ul class="tab-list">
											<li class="tab"><a href="#image-tab">Image</a></li>
											<li class="tab"><a href="#sound-tab">Sound</a></li>
											<li class="tab"><a href="#text-tab">Text</a></li>
											<li class="tab"><a href="#other-tab">Other</a></li>
										</ul>
										<div class="tab-content" id="image-tab">
											<table>
												<tr>
													<td>
														<button
															type="button"
															class="file secondary"
															data-bind="
																visible: !image.path,
																event: {
																	change: image.onSelected
																}"
															>Choose Image</button>
														<button
															type="button"
															class="secondary"
															data-bind="
																visible: image.path,
																click: image.unload
															">Remove</button>
														<!-- ko if: image.path -->
															<span class="primary" data-bind="text: image.name"></span>
														<!-- /ko -->
														<!-- ko if: !image.path -->
															<span class="primary note">No image selected</span>
														<!-- /ko -->
													</td>
												</tr>
												<tr>
													<td>
														<ul class="control-list">
															<li>
																<label for="size-contain">
																	<input id="size-contain" type="radio" name="image-size" value="contain" data-bind="checked: image.size">
																	<span>Fit</span>
																</label>
															</li>
															<li>
																<label for="size-cover">
																	<input id="size-cover" type="radio" name="image-size" value="cover" data-bind="checked: image.size">
																	<span>Fill</span>
																</label>
															</li>
														</ul>
													</td>
												</tr>
											</table>
										</div>
										<div class="tab-content" id="sound-tab" data-bind="with: sound">
											<table>
												<tr>
													<th><label>Playback</label></th>
													<td>
														<ul class="control-list">
															<li>
																<label for="loop">
																	<input id="loop" type="checkbox" data-bind="checked: loop">
																	<span>Loop</span>
																</label>
															</li>
															<li>
																<label for="shuffle">
																	<input id="shuffle" type="checkbox" data-bind="checked: shuffle">
																	<span>Shuffle</span>
																</label>
															</li>
														</ul>
													</td>
												</tr>
												<tr>
													<th>
														<label for="volume">Volume</label>
													</th>
													<td>
														<input
															id="volume"
															type="number"
															min="0"
															max="100"
															step="10"
															data-bind="value: volume">
														<span class="note">%</span>
													</td>
												</tr>
												<tr>
													<th><label for="crossover" data-bind="attr: { title: $root.help.overlap }">Overlap</label></th>
													<td>
														<input id="crossover" type="number" min="0" value="0" data-bind="value: crossover">
														<span class="note">seconds</span>
													</td>
												</tr>
												<tr>
													<th><label>Tracks</label></th>
													<td>
														<!-- ko if: tracks.length === 0 -->
														<p class="note">No tracks selected</p>
														<!-- /ko -->
														<ol data-bind="foreach: tracks, sortable: true" class="track-list">
															<li>
																<button class="secondary" data-bind="click: $parent.unload">Remove</button>
																<span data-bind="text: name, css: { primary: true, unsupported: !isPlayable }"></span>
																<audio data-bind="attr: { src: path }" preload="auto"></audio>
															</li>
														</ol>
														<button type="button" class="file" data-bind="event: { change: onSelected }">Add Tracks</button>
													</td>
												</tr>
											</table>
										</div>
										<div class="tab-content" id="text-tab" data-bind="with: text">
											<table>
												<tr>
													<th><label for="text">Text</label></th>
													<td>
														<textarea
															id="text"
															rows="5"
															data-bind="
																value: string,
																valueUpdate: 'afterkeydown'
															"></textarea>
													</td>
												</tr>
												<tr>
													<th>
														<label for="font">Font</label>
													</th>
													<td>
														<input id="font" type="text" data-bind="value: font, valueUpdate: 'afterkeydown'">
													</td>
												</tr>
												<tr>
													<th></th>
													<td>
														<ul class="control-list">
															<li>
																<label for="bold">
																	<input id="bold" type="checkbox" data-bind="checked: bold">
																	<span><b>Bold</b></span>
																</label>
															</li>
															<li>
																<label for="italic">
																	<input id="italic" type="checkbox" data-bind="checked: italic">
																	<span><i>Italic</i></span>
																</label>
															</li>
														</ul>
													</td>
												<tr>
													<th><label for="font-size">Size</label></th>
													<td>
														<input id="font-size" type="number" min="3" max="30" step="0.5" data-bind="value: size">
														<span class="note">% of screen width</span>
													</td>
												</tr>
												<tr>
													<th><label for="font-color">Color</label></th>
													<td><input id="font-color" type="color"  data-bind="spectrum: 'color'"></td>
												</tr>
												<tr>
													<th><label for="text-alignment">Align</label></th>
													<td>
														<select id="text-alignment" data-bind="value: alignment">
															<option value="left">Left</option>
															<option value="center">Center</option>
															<option value="right">Right</option>
														</select>
													</td>
												</tr>
												<tr>
													<th><label for="text-padding">Padding</label></th>
													<td>
														<input id="text-padding" type="number" min="0" max="40" step="2" data-bind="value: padding">
														<span class="note">% of screen width</span>
													</td>
												</tr>
											</table>
										</div>
										<div class="tab-content" id="other-tab">
											<table>
												<tr>
													<th><label for="background-color">Background</label></th>
													<td><input id="background-color" type="color" data-bind="value: background"></td>
												</tr>
												<tr>
													<th><label for="fade">Fade</label></th>
													<td>
														<ul class="control-list">
															<li>
																<input id="fade" type="number" min="0" value="0" data-bind="value: fade">
																<span class="note">seconds</span>
															</li>
															<li>
																<select data-bind="value: fadeDirection">
																	<option value="in out">In and out</option>
																	<option value="in">In</option>
																	<option value="out">Out</option>
																</select>
															</li>
														</ul>
													</td>
												</tr>
											</table>
										</div>
									</div>
								</div>
							</div>
							<!-- /ko -->
						<!-- /ko -->
					</div>
					<div class="help-view tab-content" id="help-tab">
						<div class="help-document">
							<ul class="table-of-contents">
								<li><a href="#help-introduction">What RPG Ambience is</a></li>
								<li><a href="#help-overview">How RPG Ambience works</a></li>
								<li><a href="#help-playing-scenes">Playing scenes</a></li>
								<li><a href="#help-stopping-scenes">Stopping scenes</a></li>
								<li><a href="#help-data">Your data</a></li>
							</ul>
							
							<h2 id="help-introduction">What RPG Ambience is</h2>
							<p>RPG Ambience is a media player that enables roleplayers to bring their sessions to life using sound and visuals.</p>
							
							<h2 id="help-overview">How RPG Ambience works</h2>
							<p>RPG Ambience is built around <dfn>scenes</dfn>. Scenes are made up of images, sounds, and text grouped together in any combination. Scenes are played and stopped using keyboard shortcuts. Scenes are organized under <dfn>adventures</dfn>.</p>
							
							<p>The interface of RPG Ambience consists of two parts: the editor and the stage.</p>
							<ul>
								<li><dfn>The editor</dfn> (the left half of the screen) contains your adventures and the scenes in them, including controls to edit them.</li>
								<li><dfn>The stage</dfn> (the right half of the screen) is where the scenes in your adventures are played.</li>
							</ul>
							
							<h2 id="help-playing-scenes">Playing scenes</h2>
							<p>There are three ways to play a scene:</p>
							<ul>
								<li>Press the hotkey associated with the scene.</li>
								<li>Type the scene's name and press <button>Enter</button>.</li>
								<li>Press the <button>Play</button> button in the top-right corner of the editor.</li>
							</ul>
							<p>When starting a scene by typing its name, it's enough to type only the first few letters of the name.</p>
							
							<h2 id="help-stopping-scenes">Stopping scenes</h2>
							<p>There are two ways to stop a scene:</p>
							<ul>
								<li>Press <button>Enter</button>.</li>
								<li>Press the <button>Stop</button> button in the top-right corner of the editor.</li>
							</ul>
							<p>Using either of these commands will only stop the topmost scene that is currently playing. To also stop the scene below it, use the command again.</p>
							
							<h2 id="help-data">Your data</h2>
							<p>RPG Ambience runs entirely within your browser; once the application has loaded, no more data is transferred between your computer and the server. All media that you use is saved inside your browser. This means that you are in complete control of your adventures and everything in them, including sound and image files.</p>
						</div>
					</div>
				</div>
			</div>
			<div
				id="gui-editor"
				class="gui-editor"
				data-bind="
					visible: guiEditorIsVisible,
					event: {
						keydown: stopPropagation,
						mousemove: scheduleHiddenInterface,
						mouseover: scheduleHiddenInterface
					}
				">
				<form
					id="gui-editor-form"
					class="gui-editor-form"
					data-bind="event: {
						mousemove: showInterfaceIndef,
						mouseover: showInterfaceIndef
					}">
					<ul class="action-list">
						<li class="action toggle">
							<button
								type="button"
								data-bind="
									click: toggleEditor,
									text: toggleButtonText">Show Editor</button>
						</li>
					</ul>
				</form>
			</div>
		</div>
		<div id="splash" class="splash">
			<div id="splash-loading">
				<p>Loading RPG Ambience…</p>
			</div>
			<div id="splash-unsupported" style="display: none">
				<p>Unfortunately, your browser does not support RPG Ambience.</p>
				<p>RPG Ambience is known to work in the following browsers:</p>
				<ul>
					<li>Google Chrome 23</li>
					<li>Mozilla Firefox 16</li>
				</ul>
			</div>
		</div>
	</body>
</html>