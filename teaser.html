<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>RPG Ambience Teaser</title>
		
		<script src="source/extensions.js"></script>
		
		<script src="libraries/ambience-stage/libraries/manymation/source/manymation.js"></script>
		<script src="libraries/ambience-stage/source/Stage.js"></script>
		<script src="libraries/ambience-stage/source/MediaPlayers/Background.js"></script>
		<script src="libraries/ambience-stage/source/MediaPlayers/Image.js"></script>
		<script src="libraries/ambience-stage/source/MediaPlayers/Sound.js"></script>
		<script src="libraries/ambience-stage/source/MediaPlayers/Text.js"></script>
		<script src="libraries/ambience-stage/source/Scene.js"></script>
		<script src="source/Theater.js"></script>
		
		<script>
			// Some fairly complex preloading logic.
			// This is only needed because everything has to sync perfectly.
			window.addEventListener('load', function() {
				var hasStarted = false;
				['dragon.ogg', '9-Trailer_Music.ogg'].forEach(function(filename) {
					var url = 'example/' + filename;
					var node = document.createElement('audio');
					node.preload = 'auto';
					node.src = url;
					node.volume = 0;
					node.play();
					
					// This seems be needed in order to prevent the node from being garbage-collected and its request canceled.
					document.body.appendChild(node);
					
					if ( filename === '9-Trailer_Music.ogg' ) {
						node.addEventListener('canplaythrough', function() {
							if ( !hasStarted ) {
								hasStarted = true;
								start();
							}
						});
						
						if ( node.readyState === 4 ) {
							if ( !hasStarted ) {
								hasStarted = true;
								start();
							}
						}
					}
				});
				
				['ishtar_rooftop.jpg', 'sintel-wallpaper-dragon.jpg'].forEach(function(filename) {
					var url = 'example/' + filename;
					var node = document.createElement('img');
					node.src = url;
				});
			});
			
			var start = function() {
				var layers = ['background', 'foreground'].map(function(id) {
					var node = document.getElementById(id);
					return new Ambience.Stage(node);
				});
				var ambience = new Ambience.App.Theater(layers[0], layers[1]);
				startTeaser(ambience);
			};
			
			var startTeaser = function(ambience) {
				var soundtrack = new Ambience.Scene(['Sound']);
				soundtrack.sound.tracks = ['example/9-Trailer_Music.ogg'];
				soundtrack.sound.loop = false;
				
				var imagine = new Ambience.Scene(['Text']);
				imagine.text.string = 'Don’t just imagine your world';
				imagine.text.style = {
					fontSize: '4.5em',
					fontFamily: 'Palatino Linotype, Georgia, serif',
					fontStyle: 'italic'
				};
				imagine.fade.in = imagine.fade.out = 1600;
				
				var life = new Ambience.Scene(['Text']);
				life.text.string = 'Bring it to life';
				life.text.style = {
					fontSize: '9em',
					fontFamily: 'Palatino Linotype, Georgia, serif',
					fontStyle: 'italic'
				};
				life.fade.out = 1600;
				
				var city = new Ambience.Scene(['Image']);
				city.image.url = 'example/ishtar_rooftop.jpg';
				city.image.style = { backgroundSize: 'cover' };
				city.fade.in = city.fade.out = 4000;
				
				var dragon = new Ambience.Scene(['Image', 'Sound']);
				dragon.image.url = 'example/sintel-wallpaper-dragon.jpg',
				dragon.image.style = { backgroundSize: 'cover' };
				dragon.sound.tracks = ['example/dragon.ogg'];
				dragon.sound.loop = false;
				dragon.fade.out = 3200;
				
				var title = new Ambience.Scene(['Text']);
				title.text.string = 'RPG Ambience';
				title.text.style = {
					fontSize: '9em',
					fontFamily: 'Constantia, Georgia, serif'
				};
				title.fade.in = title.fade.out = 3200;
				
				window.setTimeout(function() {
					ambience.playBackground(soundtrack);
					ambience.playForeground(imagine);
				}, 1000);
				
				window.setTimeout(function() {
					ambience.fadeOutForeground();
				}, 6500);
				
				window.setTimeout(function() {
					ambience.stopForeground();
					ambience.playForeground(life);
				}, 8500);
				
				window.setTimeout(function() {
					ambience.fadeOutForeground();
				}, 11500);
				
				window.setTimeout(function() {
					ambience.stopForeground();
					ambience.playForeground(city);
				}, 13500);
				
				window.setTimeout(function() {
					ambience.playForeground(dragon);
				}, 18000);
				
				window.setTimeout(function() {
					ambience.fadeOutForeground();
				}, 24000);
				
				window.setTimeout(function() {
					ambience.stopForeground();
					ambience.playForeground(title);
				}, 28000);
				
				window.setTimeout(function() {
					ambience.fadeOutForeground();
				}, 33000);
				
				window.setTimeout(function() {
					document.getElementById('information').style.visibility = 'visible';
				}, 39500);
			};
		</script>
		
		<link rel="stylesheet" href="teaser.css">
		<link rel="icon" type="image/png" href="images/icon.png">
	</head>
	<body>
		<div class="ambience">
			<div id="background" class="layer"></div>
			<div id="foreground" class="layer"></div>
		</div>
		<div class="information" id="information" style="visibility: hidden">
			<div class="primary">
				<p style="font-size: 4em"><a href="ambience.html" class="action navigate">Try RPG Ambience</a></p>
			</div>
			<div class="secondary">
				<p style="font-size: 2em">This trailer was made with RPG Ambience</p>
				<p style="font-size: 1.5em">Artwork and music © copyright Blender Foundation | <a href="http://www.sintel.org/">www.sintel.org</a></p>
			</div>
		</div>
	</body>
</html>